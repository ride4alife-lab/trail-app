<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Mogo Trails</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>

<style>
body { margin: 0; padding: 0; font-family: Arial, sans-serif; }

#map {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 100%;
}

/* Sidebar */
#sidebar {
    position: absolute;
    top: 10px;
    left: 10px;
    width: 220px;
    max-height: 90%;
    background: white;
    padding: 10px;
    border-radius: 6px;
    box-shadow: 0 0 8px rgba(0,0,0,0.2);
    overflow-y: auto;
    z-index: 1;
}

.trail-item {
    padding: 6px;
    margin-bottom: 4px;
    border-radius: 4px;
    cursor: pointer;
}

.trail-item:hover {
    background: #f0f0f0;
}

.legend {
    margin-top: 8px;
    font-size: 14px;
}
</style>
</head>
<body>

<div id="sidebar">
<b>Trails</b>
<div id="trailList"></div>

<hr>

<b>Difficulty</b>
<div class="legend">
<div><span style="color:#2ecc71;">■■</span> Easy</div>
<div><span style="color:#0074D9;">■■</span> Intermediate</div>
<div><span style="color:#000000;">■■</span> Advanced</div>
</div>
</div>

<div id="map"></div>

<script>

// USE A PUBLIC TOKEN (pk...), not sk...
mapboxgl.accessToken = 'PASTE_YOUR_PUBLIC_TOKEN_HERE';

const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v12',
    center: [150.152, -35.781],
    zoom: 14
});

map.on('load', function () {

    // Load GeoJSON
    map.addSource('trails', {
        type: 'geojson',
        data: 'map.geojson'
    });

    // Base trail layer (difficulty colors)
    map.addLayer({
        id: 'trail-lines',
        type: 'line',
        source: 'trails',
        paint: {
            'line-width': 5,
            'line-color': [
                'match',
                ['downcase', ['get', 'traildifficulty']],
                'easy', '#2ecc71',
                'intermediate', '#0074D9',
                'advanced', '#000000',
                '#ff0000'
            ]
        }
    });

    // Highlight layer (on top)
    map.addLayer({
        id: 'trail-highlight',
        type: 'line',
        source: 'trails',
        paint: {
            'line-width': 9,
            'line-color': '#FFD700'
        },
        filter: ['==', ['get', 'trailnumber'], '']
    });

    function highlightTrail(trailNumber) {
        map.setFilter('trail-highlight', ['==', ['get', 'trailnumber'], trailNumber]);
    }

    // Build sidebar
    fetch('map.geojson')
        .then(response => response.json())
        .then(data => {

            const list = document.getElementById('trailList');

            data.features.forEach(function(feature) {

                const props = feature.properties;

                const item = document.createElement('div');
                item.className = 'trail-item';
                item.textContent = props.trailnumber + ' – ' + props.trailname;

                item.onclick = function () {

                    highlightTrail(props.trailnumber);

                    const coords = feature.geometry.coordinates;

                    const bounds = coords.reduce(function(bounds, coord) {
                        return bounds.extend(coord);
                    }, new mapboxgl.LngLatBounds(coords[0], coords[0]));

                    map.fitBounds(bounds, { padding: 40 });

                    const mid = coords[Math.floor(coords.length / 2)];

                    new mapboxgl.Popup()
                        .setLngLat(mid)
                        .setHTML(
                            '<b>' + props.trailname + ' (' + props.trailnumber + ')</b><br>' +
                            'Difficulty: ' + props.traildifficulty + '<br>' +
                            'Zone: ' + props.zonename
                        )
                        .addTo(map);
                };

                list.appendChild(item);
            });
        });

    // Map click popup + highlight
    map.on('click', 'trail-lines', function (e) {
        const p = e.features[0].properties;

        highlightTrail(p.trailnumber);

        new mapboxgl.Popup()
            .setLngLat(e.lngLat)
            .setHTML(
                '<b>' + p.trailname + ' (' + p.trailnumber + ')</b><br>' +
                'Difficulty: ' + p.traildifficulty + '<br>' +
                'Zone: ' + p.zonename
            )
            .addTo(map);
    });

    map.on('mouseenter', 'trail-lines', function () {
        map.getCanvas().style.cursor = 'pointer';
    });

    map.on('mouseleave', 'trail-lines', function () {
        map.getCanvas().style.cursor = '';
    });

});

</script>

</body>
</html>